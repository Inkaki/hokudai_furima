# ローカルで動かす手順

## 開発環境
- macOS 10.13.3くらい
- Python3.6.2

## 本番環境
- CentOS7
- Python3.6.2


### 1. 環境を合わせる
pythonのバージョンは3.6.2を使用してください。

自分のPythonのバージョンが3.6.2でなく、どうすればいいかわからない場合は、[pyenv-virtualenvを使う](#pyenv-virtualenvで他のPythonバージョンを使う)といいです。ただ、anacondaをすでに使用している場合、pyenvは使わない方がいいと言われているので、別の方法を探してみてください。


### 2. cloneと必要なモジュールのインストール 
```
$ git clone https://github.com/TetsuFe/hokudai_furima
$ cd hokudai_furima
$ pip install -r requirements.txt
```


### 3. 環境変数の設定
Djangoのシークレットキーの設定をします

`HOKUDAI_FURIMA_SECRET_KEY`の値は、`***`となっていますが、任意の値で良いという訳ではないです。$ django-admin startproject testなどで生成した新しいプロジェクトのsettings.pyに書かれた`SECRET_KEY`の値を使うのが手っ取り早い（が、他にもっと手軽な方法はある気がするので、知っていたら教えてください）

### 方法1

```
$ export HOKUDAI_FURIMA_SECRET_KEY='***' # シェルが変わるたびに実行の必要あり
```

### 方法2

または、 ~/.bash_profileに以下のように追記し、
```
export HOKUDAI_FURIMA_SECRET_KEY='***'
```
```
$ source ~/.bash_profile # 一回やればもう二度とやらなくてOK
```


### 4. データベースの設定
`hokudai_furima/config/local_settings.py`を作成すると、`hokudai_furima/config/settings.py`から、その設定を読み込むようになっています。
なので、ローカルで動かす場合は、以下のように`hokudai_furima/config/local_settings.py`を設定しましょう。

```python
import os
BASE_DIR = os.path.dirname(os.path.dirname(__file__))

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}

DEBUG = True
```

この設定ができたら、次はこの設定したデータベースに空のテーブルを作成します。データベースは、テーブルにレコード（データ本体）を保存するという形式をとります。そのため、Djangoサイトで実際にデータを保存する（ユーザの新規登録など）前に、空のデータベーステーブルを作成しておく必要があります。

以下のコマンドを実行して、空のテーブルを作成します。

$ python manage.py migrate

上の`local_settings.py`の設定が有効であれば、db.sqlite3というファイルが`manage.py`と同じディレクトリにできているはずです。

（migrateオプションは、各アプリディレクトリにある、migrationsディレクトリにあるファイル（makemigrationsで作られたもの）を元に、データベースのテーブルを作成します。）


### 5. サーバー起動
ここまできたら、あとはサーバーを起動するだけです。

以下のコマンドで、サーバーを起動しましょう

```
$ python manage.py runserver <PORT> # e.g. python manage.py runserver 3000
```

ポート番号に注意してください。すでにポートが使用されている場合、エラーになる可能性があります
これでローカルでも動くはずです。


## 補足

### pyenv-virtualenvで他のPythonバージョンを使う
homebrewをインストールしていない場合、インストールしてください。windowsの人は、別のアプローチを取る必要がある場合があります。
```
$ brew update && brew upgrade pyenv pyenv-virtualenv # インストールしていなければ、これの代わりに、$ brew install pyenv pyenv-virtualenv
$ pyenv install 3.6.2 # 失敗したら、xcode-select --install
$ pyenv virtualenv 3.6.2 hokudai_furima
$ cd プロジェクトのルート # ls -alして、.gitが出てきたらOKです
$ pyenv local hokudai_furima # カレントディレクトリから下の階層にのみhokudai_furima環境となります
$ python -V
Python 3.6.2
```
