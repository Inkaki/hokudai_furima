{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container">
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    <div class="product">
        {% if product.published_date %}
            <div class="date">
                最終更新: {{ product.published_date }}
            </div>
        {% endif %}

        <p name="product_id" style="display: none;">{{product.id}}</p>


        <div class="row">
            <div class="col-sm-6 ">
                <img src="{% static "img/s3.png" %}"  alt="ロゴ" class="img-fluid">
            </div>
            <!--<div class="col-sm-3"></div>-->
            <div class="col-sm-6 ">

                    <div class="name">{{ product.title }}</div>
                    <div class="price"> {{ product.price }} 円</div>
            {% if request.user != product.seller %}
              {% if request.user in wanting_users %}
                  <form action="{% url 'product:cancel_want_product' product.pk %}" method="POST" enctype="multipart/form-data" class="post-form">{% csrf_token %}
                      <div class="button cancel-want">
                          <button type="submit" name="cancel-want"  class="cancel-want btn" >購入希望のキャンセル</button>
                      </div>
                  </form>
              {% else %}
                  <form action="{% url 'product:want_product' product.pk %}" method="POST" enctype="multipart/form-data" class="post-form">{% csrf_token %}
                      <div class="button_buy">
                          <button type="submit" name="buy"  class="buy btn" >購入希望</button>
                      </div>
                  </form>
              {% endif %}
              {% if request.user != product.seller %}
                  <a href="{% url 'product:product_direct_chat' product.pk request.user.pk %}">非公開チャット</a>
              {% endif %}
            {% endif %}
            </div>
        </div>

        <table class="table">
        <thead>
            <tr>
                <th>出品者</th>
                <th>{{ product.seller }}</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>出品状態</td>
                <td>{{ product.is_sold|yesno:"売り切れ,販売中" }}</td>
            </tr>
        </tbody>
        </table>
        {% if request.user.is_authenticated %}
            {% if product.seller.id == request.user.id %}
            <a href="{% url "product:update_product" product.pk %}" style="display: block">編集</a>
            {% endif %}
        {% endif %}
        <p>{{ product.description|linebreaksbr }}</p>

        {% if request.user.is_authenticated %}
            {% if product.seller.id == request.user.id %}
                <h2>購入希望中のユーザー</h2>
                {% if wanting_users %}
                    {% for wanting_user in wanting_users %}
                        <table class="table">
                        <tbody>
                            <tr>
                                <td>{{ wanting_user }}</td>
                                <td><a href="{% url 'product:product_direct_chat' product.pk wanting_user.pk %}">非公開チャット</a></td>
                                <!--<td><a href="</td>-->
                            </tr>
                        </tbody>
                        </table>
                    {% endfor %}
                {% else %}
                    <p>購入希望中のユーザはいません。</p>
                {% endif %}
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}
